<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Trading Bot UI</title>
  <style>
    body{font-family:Arial, sans-serif; margin:20px;}
    .row{display:flex; gap:16px; flex-wrap:wrap;}
    .card{border:1px solid #ddd; border-radius:12px; padding:12px; min-width:320px;}
    pre{background:#111; color:#0f0; padding:10px; border-radius:8px; overflow:auto; max-height:280px;}
    button{padding:10px 12px; border-radius:10px; border:1px solid #aaa; cursor:pointer;}
    input{padding:8px; border-radius:8px; border:1px solid #ccc; width:140px;}
  </style>
</head>
<body>
  <h2>Trading Bot UI</h2>

  <div class="row">
    <div class="card">
      <h3>Bot</h3>
      <button onclick="startBot()">Start</button>
      <button onclick="stopBot()">Stop</button>
      <button onclick="refreshAll()">Refresh</button>
      <pre id="status">loading...</pre>
    </div>

    <div class="card">
      <h3>Settings</h3>
      <div>
        <label>risk_pct <input id="risk_pct" type="number" step="0.1"></label><br><br>
        <label>sl_pct <input id="sl_pct" type="number" step="0.1"></label><br><br>
        <label>tp_pct <input id="tp_pct" type="number" step="0.1"></label><br><br>
        <label>leverage <input id="leverage" type="number" step="1"></label><br><br>
        <label>timeframe <input id="timeframe" type="text"></label><br><br>
        <label>symbol <input id="symbol" type="text"></label><br><br>
      </div>
      <button onclick="saveSettings()">Save</button>
      <pre id="settings">loading...</pre>
    </div>
  </div>

  <div class="row">
    <div class="card" style="flex:1">
      <h3>Trades</h3>
      <pre id="trades">loading...</pre>
    </div>

    <div class="card" style="flex:1">
      <h3>Events</h3>
      <pre id="events">loading...</pre>
    </div>
  </div>

<script>
async function api(path, opts){
  const res = await fetch(path, opts);
  if(!res.ok){
    const txt = await res.text();
    throw new Error(res.status + " " + txt);
  }
  return res.json();
}

async function refreshStatus(){
  const st = await api('/bot/status');
  document.getElementById('status').textContent = JSON.stringify(st, null, 2);
}

async function refreshSettings(){
  const s = await api('/settings');
  document.getElementById('settings').textContent = JSON.stringify(s, null, 2);
  document.getElementById('risk_pct').value = s.risk_pct;
  document.getElementById('sl_pct').value = s.sl_pct;
  document.getElementById('tp_pct').value = s.tp_pct;
  document.getElementById('leverage').value = s.leverage;
  document.getElementById('timeframe').value = s.timeframe;
  document.getElementById('symbol').value = s.symbol;
}

async function refreshTrades(){
  const t = await api('/trades?limit=50');
  document.getElementById('trades').textContent = JSON.stringify(t, null, 2);
}

async function refreshEvents(){
  const e = await api('/events?limit=200');
  document.getElementById('events').textContent = JSON.stringify(e, null, 2);
}

async function refreshAll(){
  await Promise.all([refreshStatus(), refreshSettings(), refreshTrades(), refreshEvents()]);
}

async function startBot(){
  await api('/bot/start', {method:'POST'});
  await refreshStatus();
}

async function stopBot(){
  await api('/bot/stop', {method:'POST'});
  await refreshStatus();
}

async function saveSettings(){
  const payload = {
    risk_pct: parseFloat(document.getElementById('risk_pct').value),
    sl_pct: parseFloat(document.getElementById('sl_pct').value),
    tp_pct: parseFloat(document.getElementById('tp_pct').value),
    leverage: parseInt(document.getElementById('leverage').value),
    timeframe: document.getElementById('timeframe').value,
    symbol: document.getElementById('symbol').value
  };
  await api('/settings', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
  await refreshSettings();
}

refreshAll();
setInterval(refreshAll, 5000);
</script>
</body>
</html>
